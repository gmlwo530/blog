---
title: "ì‰˜ ë¡œë”© ì‹œê°„ ê°œì„ í•˜ê¸°"
date: 2021-03-06T23:00:18+09:00
weight: 1
aliases: []
tags: ["shell", "oh-my-zsh", "zsh"]
author: ["Maru"]
showToc: true
TocOpen: true
draft: false
hidemeta: false
disableShare: false
comments: true
---

ì–´ëŠ ìˆœê°„ë¶€í„° í„°ë¯¸ë„ì˜ ì‹œì‘ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ëŠë‚Œì´ ë“¤ì—ˆë‹¤. í„°ë¯¸ë„ì„ ìì£¼ ë„ê³  í‚¤ê³  í•˜ëŠ” ìŠµê´€ì´ ìˆì–´ì„œ, ì‹œì‘í•  ë•Œë§ˆë‹¤ 3~4ì´ˆë™ì•ˆ ê²€ì€ í™”ë©´ì— ë¹„ì¶°ì§€ëŠ” ë‚´ ì–¼êµ´ì„ ë´ì•¼ í–ˆë‹¤. 1ë¶„ 1ì´ˆê°€ ì•„ê¹Œìš´ë° 3~4ì´ˆì˜ ì‹œê°„ì„ ë‚´ ì–¼êµ´ì„ ë³´ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë„ˆë¬´ ì•„ê¹ë‹¤. ì›ì¸ì„ ì°¾ê³  í•´ê²°í•´ì„œ ì†ë„ë¥¼ ê°œì„ í•˜ê³  ì‹¶ì€ ë‹ˆì¦ˆë¡œ êµ¬ê¸€ë§ì„ í•´ë´¤ë‹¤. ë‹¤í–‰íˆ, ë‚˜ì™€ ê°™ì€ ë‹ˆì¦ˆë¥¼ ê°€ì§€ê³  ìˆëŠ” ì‚¬ëŒì˜ [ì˜ ì •ë¦¬í•œ ë¸”ë¡œê·¸ ê¸€](https://blog.mattclemente.com/2020/06/26/oh-my-zsh-slow-to-load.html)ì„ ë°œê²¬í–ˆë‹¤. ë°©ë²•ë§Œ ì•Œê³  ì‹¶ìœ¼ë©´ í•´ë‹¹ ê¸€ì„ ë´ë„ ì¢‹ì§€ë§Œ, ë‚˜ëŠ” shellì— ëŒ€í•œ ì§€ì‹ì´ í•˜ë‚˜ë„ ì—†ì–´ì„œ ê¸€ì— ë‚˜ì˜¤ëŠ” shellì˜ ê°œë…ë“¤ì„ ì´ë²ˆ ê¸€ì—ì„œ ì •ë¦¬í•˜ë©° ë…¸íŠ¸ë¶ì—ì„œ 3~4ì´ˆ ë™ì•ˆ ê²€ì€ ê±°ìš¸ì´ ìƒê¸°ëŠ” ë¬¸ì œë¥¼ ì¢€ ë” ì§§ê²Œ ë‚˜ì˜¤ë„ë¡ í•´ë³´ê³ ì í•œë‹¤.

ê¸€ì„ ì‹œì‘í•˜ê¸° ì „ì— ë‚˜ì˜ shell ì‹œì‘ ì‹œê°„ì€ ì–´ë–¤ì§€ ì•Œì•„ë³´ì.

```zsh
â¯ for i in {1..5}; do /usr/bin/time $SHELL -i -c exit; done
```

ë‚˜ëŠ” 3.4ì´ˆì—ì„œ 3.6ì´ˆê°€ ë‚˜ì™”ë‹¤. ëŠë¦¬ë‹¤! ëŠë¦¬ë‹¤!! ëŠë¦¬ë‹¤!!!

## âš™ï¸ í™˜ê²½

ë‚´ê°€ ì‚¬ìš©í•˜ê³  ìˆëŠ” í™˜ê²½ì€ ì•„ë˜ì™€ ê°™ë‹¤.

- ë§¥ë¶ 16ì¸ì¹˜
- zsh & oh-my-zsh
- ê¸°ë³¸ í„°ë¯¸ë„
- zsh plugin
  - git
  - zsh-autosuggestions
  - zsh-syntax-highlighting
- virtual environments
  - pyenv

## â± í˜„ì¬ shell ë¡œë”© ì‹œê°„ ì¸¡ì •

ë‚´ê°€ ì§€ê¸ˆ ëŠë¦°ê±´ ì•Œê² ëŠ”ë°, ì–¼ë§ˆë‚˜ ëŠë¦°ì§€ ì•Œì•„ì•¼ì§€ ê°œì„  í–ˆì„ ë•Œ ë¹¨ë¼ì¡Œêµ¬ë‚˜ë¥¼ ì•Œ ìˆ˜ ìˆì§€ ì•Šì€ê°€?

ì¸¡ì •í•˜ëŠ” ë²•ì€ ê½¤ ê°„ë‹¨í•˜ë‹¤.

```zsh
â¯ for i in {1..5}; do /usr/bin/time $SHELL -i -c exit; done
```

- `for in` / `do` / `done`: ê½¤ ì§ê´€ì ì´ë‹¤. ë°˜ë³µë¬¸ì¸ë° `do` í‚¤ì›Œë“œë¡œ í•´ì•¼í•  ì¼ì„ ëª…ì‹œ í•´ì¤€ë‹¤ëŠ”ê²Œ ì¸ìƒì ì´ë‹¤.
- `;`: for ë¬¸ì„ í•œ ì¤„ë¡œ ì‘ì„± í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” êµ¬ë¶„ìë‹¤.
- `{1..5}`: sequenceë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤. ì°¸ì¡°í•œ ë¸”ë¡œê·¸ì—ì„œëŠ” `$(seq 1 10)`ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, êµ¬ì‹ ë¬¸ë²•ì´ë¼ê³  í•œë‹¤. ê²Œë‹¤ê°€ 10ë²ˆê¹Œì§€ ì²´í¬í•  í•„ìš”ë„ ì—†ì´ ëŠë ¤ì„œ 5íšŒ ì¸¡ì •í•˜ë„ë¡ ë³€ê²½í•˜ì˜€ë‹¤.
- `/usr/bin/time`: ë’¤ì— ì˜¤ëŠ” ëª…ë ¹ì–´(ì˜ˆì œì—ì„œëŠ” `$SHELL -i -c`)ê°€ ì‹¤í–‰ë˜ê³  ëë‚  ë•Œê¹Œì§€ì˜ ì‹œê°„ì„ ì¸¡ì •í•´ì„œ í†µê³„ë¥¼ ë‚´ì£¼ëŠ” **ëª…ë ¹ì–´**ë‹¤.
- `$SHELL`: í˜„ì¬ ì‹¤í–‰ë˜ê³  ìˆëŠ” shellì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ëª…ë ¹ì–´ì˜ ê²½ë¡œë¥¼ ë‚˜íƒ€ë‚´ëŠ” í™˜ê²½ ë³€ìˆ˜ë‹¤. ë‚´ shellì€ zshë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ `echo $SHELL`ë¥¼ ì…ë ¥í•˜ë©´ `/bin/zsh`ê°€ ë¦¬í„´ ëœë‹¤.
  - `-i`: shellì„ ê°•ì œë¡œ interactiveí•˜ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” ì¸ìë‹¤.([ì¢€ ë” ì•Œì•„ë³´ê¸°](https://unix.stackexchange.com/questions/551654/what-does-zshs-i-option-actually-do))
  - `-c`: ì´ ì¸ì ë’¤ë¡œ ë‚˜ì˜¤ëŠ” ì²« ë²ˆì§¸ ì¸ìë¥¼ ëª…ë ¹ì–´ë¡œì¨ ì¸ì‹í•˜ê³  ì‹¤í–‰ì‹œí‚¨ë‹¤.
- `exit`: shellì„ ì¢…ë£Œí•œë‹¤.

{{<line_break>}}

ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ ëœë‹¤. ê°œì¸ í„°ë¯¸ë„ì˜ ì„¤ì •ì— ë”°ë¼ ì¶”ê°€ì ì¸ í…ìŠ¤íŠ¸ê°€ ì¶œë ¥ ë  ìˆ˜ë„ ìˆë‹¤. ìœ ì‹¬íˆ ë´ì•¼ í•  ë¶€ë¶„ì€ `real`, `user`, `sys` í‚¤ì›Œë“œë‹¤.

```zsh
  3.62 real         1.85 user         1.70 sys
  3.52 real         1.88 user         1.65 sys
  3.55 real         1.88 user         1.67 sys
  3.57 real         1.88 user         1.70 sys
  4.07 real         2.13 user         1.92 sys
```

- `real`: í˜¸ì¶œ í›„ ì‹œì‘ë¶€í„° ëë‚  ë•Œê¹Œì§€ ì¸¡ì • ëœ ì‹œê°„ì´ë‹¤. ì´ ê¸€ì—ì„œ ìš°ë¦¬ê°€ ê°œì„ í•˜ê³ ì í•˜ëŠ” "shellì´ ì‹œì‘í•˜ëŠ” ì‹œê°„"ì´ë¼ê³  ìƒê°í•˜ì‹œë©´ ëœë‹¤.
- `user`: í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ ë  ë•Œ kernel ì™¸ë¶€ì—ì„œ CPUê°€ ì†Œë¹„í•œ ì‹œê°„ì´ë‹¤.
- `sys`: í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ ë  ë•Œ kernel ë‚´ë¶€ì—ì„œ CPUê°€ ì†Œë¹„í•œ ì‹œê°„ì´ë‹¤.
  (`real`, `user`, `sys` í‚¤ì›Œë“œì— ëŒ€í•´ ì¢€ ë” ìì„¸íˆ ì•Œê³  ì‹¶ìœ¼ë©´ í•„ìê°€ [ì°¸ê³ í•œ ê¸€](https://stackoverflow.com/questions/556405/what-do-real-user-and-sys-mean-in-the-output-of-time1)ì„ ì½ì–´ë³´ì‹œëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤..)

ì‹œê°„ì´ ë„ˆë¬´ ê¸¸ë‹¤. ê°œì„ ì„ í•´ë³´ì.

## â—ï¸ ê°œì„ ì„ ì‹œì‘í•˜ê¸° ì „ì—

ì´ì œ ê°œì„ ì„ ì‹œì‘í•˜ê²Œ ë˜ë©´ ì„¤ì • íŒŒì¼ë“¤ì„ ë³€ê²½í•˜ê³  ë°˜ì˜ í•  ê²ƒì´ë‹¤. ì•„ë§ˆë„ ì œì¼ ë§ì´ `~/.zshrc` ë¶€ë¶„ì„ ìˆ˜ì • í•  ê²ƒì´ë‹¤. í•´ë‹¹ íŒŒì¼ì˜ ë³€ê²½ ì‚¬í•­ì„ ë³€í•˜ê¸° ìœ„í•´ì„œ shellì˜ sessionì„ ë‹¤ì‹œ ì‹œì‘í•´ì•¼ í•˜ëŠ”ë° `exec zsh` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```zsh
â¯ exec zsh
```

- ì´ ë¶€ë¶„ì—ì„œ êµ‰ì¥íˆ ë†€ëëŠ”ë°, í‰ì†Œì— `~/.zshrc` ìˆ˜ì • ì‚¬í•­ì„ ë°˜ì˜í•˜ê¸° ìœ„í•´ `source ~/.zshrc` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì´ë‹¤. [oh-my-zsh ê³µì‹ ë¬¸ì„œ](https://github.com/ohmyzsh/ohmyzsh/wiki/FAQ#how-do-i-reload-the-zshrc-file)ë¥¼ ë³´ë©´ `source ~/.zshrc`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì˜ëª»ëœ ë°©ë²•ì´ë¼ê³  ë§í•œë‹¤.

## â± Plugin ì‹œê°„ ì¸¡ì •

ë¨¼ì € `~/.zshrc`ì— ì„ ì–¸ ëœ í”ŒëŸ¬ê·¸ì¸ì´ ê±¸ë¦¬ëŠ” ì‹œê°„ë¶€í„° ì¸¡ì •í•´ë³´ì.

`~/.oh-my-zsh/oh-my-zsh.sh` íŒŒì¼ì„ ì—´ì–´ë³´ë©´ `~/.zshrc`ì— ì •ì˜ ëœ í”ŒëŸ¬ê·¸ì¸ì„ ë¡œë“œí•˜ëŠ” ë¶€ë¶„ì´ ìˆë‹¤. ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```zsh
# Load all of the plugins that were defined in ~/.zshrc
for plugin ($plugins); do
  if [ -f $ZSH_CUSTOM/plugins/$plugin/$plugin.plugin.zsh ]; then
    source $ZSH_CUSTOM/plugins/$plugin/$plugin.plugin.zsh
  elif [ -f $ZSH/plugins/$plugin/$plugin.plugin.zsh ]; then
    source $ZSH/plugins/$plugin/$plugin.plugin.zsh
  fi
done
```

ì´ì œ ì´ ì½”ë“œì— ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ì½”ë“œë¥¼ ë„£ì–´ë³´ì.

```zsh
# Load all of the plugins that were defined in ~/.zshrc
for plugin ($plugins); do
  timer=$(($(gdate +%s%N)/1000000))
  if [ -f $ZSH_CUSTOM/plugins/$plugin/$plugin.plugin.zsh ]; then
    source $ZSH_CUSTOM/plugins/$plugin/$plugin.plugin.zsh
  elif [ -f $ZSH/plugins/$plugin/$plugin.plugin.zsh ]; then
    source $ZSH/plugins/$plugin/$plugin.plugin.zsh
  fi
  now=$(($(gdate +%s%N)/1000000))
  elapsed=$(($now-$timer))
  echo $elapsed":" $plugin
done
```

ì¶”ê°€ ëœ ì½”ë“œë¥¼ ì‚´í´ ë³´ë©´ `timer`ë¼ëŠ” ë³€ìˆ˜ì— plugin ë¡œë“œ ì‹œì‘ ì‹œê°„ì„ ë‹´ì•„ë†“ê³ , `now`ë¼ëŠ” ë³€ìˆ˜ì— plugin ë¡œë“œ ë ì‹œê°„ì„ ë‹´ì•„ì„œ ê·¸ ì°¨ì´ë¥¼ ë³´ê³  ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ê²ƒì´ë‹¤.

ì¸¡ì •í•˜ëŠ” ê³¼ì •ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ì

- `$(())`: ê³„ì‚°í•œ ê°’ì„ ë³€ìˆ˜ì— ë„£ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ë¬¸ë²•ì´ë‹¤.
- `gdate`: GNUì˜ `date` ëª…ë ¹ì–´ì´ë‹¤.
  - `+`: `%s`, `%N`ë“± formatì„ ì‚¬ìš©í•˜ë ¤ë©´ ì ‘ë‘ë¡œ ë¶™í˜€ì•¼ í•œë‹¤.
  - `%s`: 1970-01-01 00:00:00 UTCë¶€í„°ì˜ ì‹œê°„ì„ ì´ˆ(seconds)ë¡œ ë°˜í™˜í•œë‹¤.
  - `%N`: ì‹œê°„ì„ ë‚˜ë…¸ì´ˆë¡œ í‘œí˜„í•œë‹¤.

gdate ëª…ë ¹ì–´ëŠ” Homebrewë¡œ [coreutils](https://formulae.brew.sh/formula/coreutils)ë¥¼ ì„¤ì¹˜í•˜ë©´ ì‚¬ìš© í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ë‹¤.

ë§Œì•½ ì„¤ì¹˜í•˜ê¸° ì‹«ê±°ë‚˜ Homebrewë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê¸°ë³¸ ë‚´ì¥ ëœ pythonì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤. (ì´ë•Œ python versionì— ë”°ë¼ print ë¬¸ë²•ì´ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì„ ì£¼ì˜í•˜ì.)

```zsh
timer=$(($(python -c 'from time import time; print(int(round(time() * 1000)))')))

now=$(($(python -c 'from time import time; print(int(round(time() * 1000)))')))
```

- ì°¸ê³ ë¡œ pythonìœ¼ë¡œ ì‹¤í–‰í•´ë³´ë‹ˆ `gdate`ë³´ë‹¤ ì¢€ ë” ë¡œë“œ ì‹œê°„ì´ ê¸¸ì—ˆë‹¤. ì•„ë§ˆ python ì½”ë“œ ì‹¤í–‰ ì‹œê°„ì´ ì¢€ ë” ê±¸ë¦°ê²Œ ì•„ë‹ê¹Œ ì¶”ì¸¡í•´ë³¸ë‹¤.

{{< line_break >}}

ì¤‘ìš”í•œ ê²ƒì€ ë‘˜ ë‹¤ ë°€ë¦¬ ì´ˆë¡œ í™˜ì‚°í•´ì„œ ê³„ì‚°í•˜ê³  ìˆë‹¤.

{{< line_break >}}

ë‚´ ë§¥ë¶ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ë‚˜ì™”ë‹¤

```zsh
â¯ exec zsh
15: git
21: zsh-syntax-highlighting
7: zsh-autosuggestions
```

21 ë°€ë¦¬ì´ˆë©´ 0.021ì´ˆë¼ëŠ” ë§ì¸ë°, í”ŒëŸ¬ê·¸ì¸ì€ ì†ë„ë¥¼ ëŠë¦¬ê²Œ í•˜ëŠ” ë²”ì¸ì´ ì•„ë‹Œë“¯ í•˜ë‹¤..

- â—ï¸ ì‹œê°„ ì¸¡ì •ì´ ëë‚˜ë©´ ì‹œê°„ ì¸¡ì • ì½”ë“œë¥¼ ê¼­ ì§€ìš°ë„ë¡ í•˜ì!

## ğŸ§­ ë” í™•ì‹¤í•œ ì›ì¸ì„ ì°¾ì•„ì„œ

pluginì´ ì¹˜ëª…ì ì¸ ì›ì¸ì´ ì•„ë‹ˆë¯€ë¡œ zshì´ ë¡œë“œ ë  ë•Œ ì¼ì–´ë‚˜ëŠ” ì¼ë“¤ì˜ ì‹œê°„ì„ ì¸¡ì •í•´ì•¼ í•œë‹¤.

zshì€ ê¸°ê°€ë§‰íŒ í”„ë¡œíŒŒì¼ë§ ëª¨ë“ˆì„ ê°€ì§€ê³  ìˆëŠ”ë°, ì´ë¦„í•˜ì—¬ [`zsh/zprof`](http://zsh.sourceforge.net/Doc/Release/Zsh-Modules.html#The-zsh_002fzprof-Module)ë‹¤.

êµ‰ì¥íˆ í¸ë¦¬í•˜ê²Œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤. ì¼ë‹¨ `~/.zshrc` íŒŒì¼ì„ ì—´ì–´ì„œ ì œì¼ ì²« ë¬¸ì¥ì— `zmodload zsh/zprof`ë¥¼ ì¶”ê°€ í•´ì¤€ë‹¤.

```zsh
zmodload zsh/zprof
# If you come from bash you might have to change your $PATH.
# export PATH=$HOME/bin:/usr/local/bin:$PATH
# ....
```

ì˜ ì €ì¥í•˜ê³  `exec zsh` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ shellì„ ë‹¤ì‹œ ì‹¤í–‰í•´ì¤€ í›„ ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ í”„ë¡œíŒŒì¼ë§í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

```zsh
â¯ zprof
num  calls                time                       self            name
-----------------------------------------------------------------------------------
 1)    3         390.53   130.18   39.51%    390.53   130.18   39.51%  _pyenv_virtualenv_hook
 2)    1         159.78   159.78   16.17%    159.78   159.78   16.17%  compdump
 3)    1         350.09   350.09   35.42%    107.25   107.25   10.85%  compinit
 4)  781          83.97     0.11    8.50%     83.97     0.11    8.50%  compdef
 ....
```

- _ì—¬ê¸°ì„œ `compdump`, `compinit`, `compdef`ë„ ê½¤ ë§ì€ ì§€ë¶„ì„ ê°€ì§€ê³  ìˆëŠ”ë°, ì ê¹ ì°¾ì•„ë³´ë‹ˆ í•´ë‹¹ í•¨ìˆ˜ë“¤ì„ ì–´ë–»ê²Œë“  ì‹œê°„ ìµœì í™”ë¥¼ í•œë‹¤ê³  í•´ë„ ë¶€ì‘ìš©ì´ ì¼ì–´ë‚˜ì§€ ì•Šì„ê±°ë¼ëŠ” ë³´ì¥ì´ ì—†ë‹¤ê³  í•œë‹¤. ë¶„í•˜ì§€ë§Œ ì–˜ë„¤ë“¤ì€ ê°€ë§Œíˆ ë‘ì.._

ì°¸ê³ í•œ ê¸€ì˜ ì €ìëŠ” í”„ë¡œíŒŒì¼ë§ ì •ë³´ ì¤‘ í•¨ìˆ˜ ì´ë¦„ ì™¼ìª½ì— ìˆëŠ” í¼ì„¼íŠ¸(%) ê°’ì´ ì†ë„ ê°œì„ ì„ í•˜ëŠ”ë° ë„ì›€ì´ ëœë‹¤ê³  í•œë‹¤. ì € í¼ì„¼íŠ¸(%) ê°’ì€ ì‰˜ ë¡œë“œ ì‹œê°„ ì¤‘ì— í•´ë‹¹ í•¨ìˆ˜ê°€ ë¡œë“œ ëœ ì‹œê°„ì˜ ì§€ë¶„ì„ ëœ»í•œë‹¤. (ì¼ë¦¬ ìˆëŠ” ë§ì´ë‹¤...!)

ë²”ì¸ì„ ì°¾ì•˜ë‹¤! íŒŒì´ì¬ ë²„ì „ê³¼ ê°€ìƒ í™˜ê²½ ê´€ë¦¬ë¥¼ í¸í•˜ê²Œ í•´ì£¼ëŠ” [pyenv](https://github.com/pyenv/pyenv)ê°€ ë‚  ë¶ˆí¸í•˜ê²Œ ë§Œë“¤ê³  ìˆì—ˆë‹¤...ğŸ•µğŸ»â€â™‚ï¸

## ğŸ”§ ê°€ìƒ í™˜ê²½ ê´€ë¦¬ íˆ´ê³¼ ì†ë„ ê°œì„  ë‘ ë§ˆë¦¬ í† ë¼ ì¡ê¸°!

ì œì¼ ë¹ ë¥´ê³  í¸í•œ ë°©ë²•ì€ ê·¸ëƒ¥ pyenvë¥¼ ì§€ìš°ë©´ ëœë‹¤. í•˜ì§€ë§Œ ê³ ì‘ 1~2ì´ˆì˜ ì´ë“ì„ ë³´ê² ë‹¤ê³  ì„¸ìƒ í¸ë¦¬í•œ ê°€ìƒ í™˜ê²½ ê´€ë¦¬ íˆ´ì„ ì§€ìš°ëŠ”ê±´ ë©ì²­í•œ ì§“ì´ë‹¤.

ì´ì œ ì°¸ê³ í•œ ê¸€ì˜ ì €ìëŠ” 2ê°€ì§€ ë°©ë²•ì„ ì œì‹œí•œë‹¤.

1. Lazy Loading
2. [Caching Eval](https://blog.mattclemente.com/2020/06/26/oh-my-zsh-slow-to-load.html#caching-eval)

ê°œì¸ì ì¸ ìƒê°ìœ¼ë¡œ 2ë²ˆì§¸ ë°©ë²•ì€ cachingìœ¼ë¡œ ì¸í•´ ë¦¬ì†ŒìŠ¤ê°€ ì†Œëª¨ë˜ê³ , 1ë²ˆ ë°©ë²•ë³´ë‹¤ ì‹œê°„ ìµœì í™”ê°€ ëœ ë˜ì–´ 1ë²ˆ ë°©ë²•ì„ ì„ íƒí•˜ê¸°ë¡œ í–ˆë‹¤.(ì‚¬ì‹¤ ì´ê±´ ì‹¤í–‰í•˜ëŠ” í™˜ê²½ ê´€ë¦¬ íˆ´ê³¼ ë””ë°”ì´ìŠ¤ ë³„ë¡œ ë‹¤ë¥¼ì§€ë„ ëª¨ë¥¸ë‹¤.) 2ë²ˆ ë°©ë²•ì€ ì°¸ê³  ê¸€ì˜ ë§í¬ë¥¼ ê±¸ì—ˆìœ¼ë‹ˆ, ì°¸ê³ í•˜ë©´ ì¢‹ì„ë“¯ í•˜ë‹¤.

## ğŸ’¤ Lazy Loading

ì´ ë°©ë²•ì´ í•´ê²°ì±…ì´ ë˜ëŠ” ì´ìœ ëŠ” ê°„ë‹¨í•˜ë‹¤. ì‰˜ì´ ì‹¤í–‰ ë  ë•Œë§ˆë‹¤ `pyenv`ê°€ ë¡œë“œ ë  í•„ìš”ê°€ ì—†ë‹¤ëŠ”ê²Œ í¬ì¸íŠ¸ë‹¤. ì•ˆ ì“°ëŠ”ë° ë¡œë“œ í•  í•„ìš”ê°€ ì—†ì§€ ì•Šì€ê°€? ê·¸ëƒ¥ ë‚´ê°€ ì›í•  ë•Œ ë¡œë“œí•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ì°¸ê³  ê¸€ì—ì„œëŠ” ì €ìê°€ `nvm`ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, [zsh-nvm](https://github.com/lukechilds/zsh-nvm) í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•´ì„œ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤€ë‹¤.

ìŠ¬í”„ê²Œë„ `pyenv`ì—ê²ŒëŠ” `zsh-nvm` ê°™ì´ starê°€ ë§ì€ í”ŒëŸ¬ê·¸ì¸ì´ ì—†ë‹¤. ê·¸ë˜ë„ ê°“ê°“ ê°œë°œìë¶„ë“¤ì´ ì´ë¯¸ ë§Œë“¤ì–´ ë†“ì•˜ë‹¤. [zsh-pyenv-lazy](https://github.com/davidparsson/zsh-pyenv-lazy)ë¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì¸ë° íŒŒì¼ ì„¤ì¹˜ë„ ê°„ë‹¨í•˜ê³  ì½”ë“œë„ ì§ê´€ì ì´ë¼ starì™€ last commit ë‚ ì§œë¥¼ ì‹ ê²½ì“°ì§€ ì•Šê³  ì„¤ì¹˜í–ˆë‹¤.

- ì €ìê°€ `rbenv`ëŠ” lazy loadí•˜ëŠ” í¸í•œ ë°©ë²•ì„ ëª» ì°¾ì•˜ë‹¤ê³  í•œë‹¤. ê·¸ë˜ì„œ 2ë²ˆ ë°©ë²•ì„ ì‚¬ìš©í•˜ë¼ê³  í•˜ëŠ”ë°, `zsh-pyenv-lazy`ì²˜ëŸ¼ êµ¬í˜„ í•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ í•˜ëŠ” ì¡°ì‹¬ìŠ¤ëŸ¬ìš´ ì¶”ì¸¡ì„ í•´ë³¸ë‹¤.(ë‚´ê°€ ë§Œë“¤ì–´ë³¼ê¹Œ?)

í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ í›„ ê¸°ì¡´ì— ì…ë ¥ í•´ë†“ì€ `pyenv` ì‹¤í–‰ ì½”ë“œë¥¼ `~/.zshrc`ì—ì„œ ì‚­ì œí–ˆë‹¤.

```zsh
# í˜¹ì‹œ ëª¨ë¥´ë‹ˆ ì£¼ì„ ì²˜ë¦¬~
# export PYENV_ROOT="$HOME/.pyenv"
# export PATH="$PYENV_ROOT/bin:$PATH"
# if command -v pyenv 1>/dev/null 2>&1; then
#   eval "$(pyenv init -)"
# fi
# eval "$(pyenv virtualenv-init -)"
```

ê·¸ë¦¬ê³  ë‹¤ì‹œ ì‹œê°„ ì¸¡ì •ì„ í•˜ë‹ˆ..!

```zsh
â¯ for i in {1..5}; do /usr/bin/time $SHELL -i -c exit; done
        3.24 real         1.77 user         1.44 sys
        2.87 real         1.52 user         1.34 sys
        2.86 real         1.51 user         1.33 sys
        2.87 real         1.51 user         1.34 sys
        2.83 real         1.50 user         1.32 sys
```

ëŒ€ëµ 0.5~0.8ì´ˆì˜ ì‹œê°„ì„ ì¤„ì˜€ë‹¤.(ê³ ì‘..? í˜„íƒ€ê°€ ì¢€ ì˜¤ëŠ”ë°..?)

ë­”ê°€ ì•„ì§ ë‚´ê°€ ë°œê²¬í•˜ì§€ ëª»í•œ ì›ì¸ë“¤ì´ ìˆì„ ê²ƒì´ë‹¤. ì¶”í›„ì— ë‹¤ì‹œ í•œë²ˆ ì—°êµ¬í•´ë´ì•¼ê² ë‹¤.

ê·¸ë˜ë„ 0.8ì´ˆì˜ ì´ë“ê³¼ zsh, shell ë¬¸ë²•ì— ëŒ€í•œ ì§€ì‹ì„ ì–»ì—ˆê¸° ë•Œë¬¸ì— ë‚˜ë¦„ **ì„±ê³µì **ì´ë¼ê³  ìƒê°í•˜ë©° ê¸€ì„ ë§ˆì¹œë‹¤.

---

**Reference**

- [https://blog.mattclemente.com/2020/06/26/oh-my-zsh-slow-to-load.html#handling-virtual-environments](https://blog.mattclemente.com/2020/06/26/oh-my-zsh-slow-to-load.html#handling-virtual-environments)

- [https://man7.org/linux/man-pages/man1/time.1.html](https://man7.org/linux/man-pages/man1/time.1.html)
- [https://stackoverflow.com/questions/556405/what-do-real-user-and-sys-mean-in-the-output-of-time1](https://stackoverflow.com/questions/556405/what-do-real-user-and-sys-mean-in-the-output-of-time1)
- [https://linux.die.net/man/1/zsh](https://linux.die.net/man/1/zsh)
- [https://unix.stackexchange.com/questions/551654/what-does-zshs-i-option-actually-do](https://unix.stackexchange.com/questions/551654/what-does-zshs-i-option-actually-do)
- [https://github.com/ohmyzsh/ohmyzsh/wiki/FAQ#how-do-i-reload-the-zshrc-file](https://github.com/ohmyzsh/ohmyzsh/wiki/FAQ#how-do-i-reload-the-zshrc-file)
- [https://man7.org/linux/man-pages/man1/date.1.html](https://man7.org/linux/man-pages/man1/date.1.html)
